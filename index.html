<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Happy Birthday, Sweetheart ðŸŽ‚</title>
<style>
  /* ============ ROMANTIC THEME (OFFLINE) ============ */
  :root{
    --bg1:#2a0d15; --bg2:#521b2c; --bg3:#7a2e43;            /* deep rosy gradient */
    --glass:rgba(255,255,255,.10); --border:rgba(255,255,255,.25);
    --text:#ffe9ee; --muted:#ffe9eecc;
    --accent:#ff6b81; --accent2:#ffd166; --btn:#ffc2cf;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent}
  html,body{height:100%;margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 50% -10%, #ff6b8122, transparent 60%),
      linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
    overflow:hidden;
  }
  .wrap{min-height:100%; display:flex; flex-direction:column; align-items:center; padding:16px 14px 120px}
  header{margin-top:6px; text-align:center}
  .title{
    font-size:40px; letter-spacing:.4px;
    font-variation-settings:"wght" 700;
    text-shadow:0 6px 22px #000a, 0 0 18px #ff5a7090;
  }
  .sub{font-size:13px; color:var(--muted)}
  .stage{
    width:min(94vw,720px);
    margin-top:18px; min-height:240px; padding:18px;
    background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
    border:1px solid var(--border); border-radius:18px;
    backdrop-filter:blur(8px); box-shadow:0 20px 60px #0008;
    position:relative; overflow:hidden;
  }

  /* Top lights (bulbs) */
  .bulbs{position:fixed; top:8px; left:50%; transform:translateX(-50%); display:flex; gap:16px; z-index:6; opacity:0; transition:opacity .6s}
  .bulbs.on{opacity:1}
  .bulb{
    width:26px; height:40px; border-radius:12px; background:#321c28;
    box-shadow:inset 0 -8px 10px #0007; position:relative; opacity:.6;
  }
  .bulb::before{content:""; position:absolute; bottom:100%; left:50%; transform:translateX(-50%); width:5px; height:10px; background:#50314a; border-radius:2px}
  .bulb.on{animation:glow 1.6s ease-in-out infinite alternate}
  @keyframes glow{
    0%  { filter:drop-shadow(0 0 4px #ff6b81); background:#ff6b81 }
    50% { filter:drop-shadow(0 0 12px #ffd166); background:#ffd166 }
    100%{ filter:drop-shadow(0 0 6px #4cc9f0); background:#4cc9f0 }
  }

  /* Messages */
  .msg{
    font-size:18px; line-height:1.55; text-align:center;
    margin:16px auto 6px; max-width:85%;
    opacity:0; transform:translateY(14px) scale(.98); transition:opacity .6s, transform .6s;
  }
  .msg.show{opacity:1; transform:translateY(0) scale(1)}
  .big{
    font-size:46px; font-weight:800; letter-spacing:.5px;
    text-shadow:0 0 12px #ff6b8166, 0 4px 18px #0009;
    opacity:0; transform:scale(.92); transition:opacity 1s, transform 1s;
  }
  .big.show{opacity:1; transform:scale(1)}

  /* Cake */
  .cakeWrap{display:none; justify-content:center; align-items:center; height:170px}
  .cake{position:relative; width:150px; height:100px; border-radius:16px; background:linear-gradient(180deg,#ffe8ef,#ffd7e3); box-shadow:0 16px 36px #0008}
  .icing{position:absolute; top:-14px; left:0; right:0; height:28px; border-radius:18px 18px 8px 8px; background: radial-gradient(circle at 20px 10px,#fff,transparent 45%), radial-gradient(circle at 60px 10px,#fff,transparent 45%), radial-gradient(circle at 100px 10px,#fff,transparent 45%), radial-gradient(circle at 140px 10px,#fff,transparent 45%), #fff}
  .candle{position:absolute; top:-36px; left:50%; transform:translateX(-50%); width:10px; height:34px; border-radius:6px; background:repeating-linear-gradient(45deg,#ff9aa2 0 6px,#ffd166 6px 12px)}
  .flame{position:absolute; top:-14px; left:50%; transform:translateX(-50%); width:16px; height:22px; border-radius:50%; background:radial-gradient(circle at 40% 40%,#fff,#ffe07a 55%,#ff8c37 70%,transparent 72%); opacity:0}
  .flame.on{opacity:1; animation:flicker 1.1s ease-in-out infinite}
  @keyframes flicker{0%{transform:translateX(-50%) translateY(-1px) scale(1)} 50%{transform:translateX(-50%) translateY(-5px) scale(1.06)} 100%{transform:translateX(-50%) translateY(-1px) scale(1)}}

  /* Bottom single button */
  .controls{position:fixed; bottom:26px; left:50%; transform:translateX(-50%); width:min(92vw,420px); z-index:9}
  .btn{
    width:100%; padding:14px 18px; font-size:18px; font-weight:800; letter-spacing:.2px;
    color:#1b0e24; background:linear-gradient(180deg,#ffe3ea,#ffc2d2);
    border:1px solid var(--border); border-radius:14px; cursor:pointer;
    box-shadow:0 16px 40px #0009, inset 0 1px 0 #fff8;
  }
  .btn:disabled{opacity:.65; cursor:default}
  .tip{position:fixed; bottom:86px; left:50%; transform:translateX(-50%); font-size:12px; color:var(--muted); z-index:9}

  /* FX layers */
  .fx{position:fixed; inset:0; pointer-events:none; z-index:4; overflow:hidden}
  .heart{position:absolute; bottom:-40px; font-size:22px; filter:drop-shadow(0 4px 10px #0006); animation:floatUp linear forwards}
  @keyframes floatUp{0%{transform:translateY(0) scale(1); opacity:1} 100%{transform:translateY(-110vh) scale(1.5); opacity:0}}
  .balloon{position:absolute; bottom:-160px; border-radius:50%/60%; filter:drop-shadow(0 10px 18px #0006); animation:balloonUp linear forwards}
  .string{position:absolute; bottom:-88px; left:50%; width:2px; height:90px; transform:translateX(-50%); background:linear-gradient(180deg,#0002,transparent)}
  @keyframes balloonUp{0%{transform:translateY(0)} 100%{transform:translateY(-120vh)}}

  canvas#confetti{position:fixed; inset:0; z-index:5; pointer-events:none}
  canvas#fireworks{position:fixed; inset:0; z-index:7; pointer-events:none}

  /* Start curtain */
  .curtain{position:fixed; inset:0; z-index:10; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#190419,#3c005e 60%,#6800a8)}
  .start{font-size:28px; font-weight:800; padding:16px 26px; border-radius:20px; color:#1b0e24; background:linear-gradient(180deg,#ffe3ea,#ffc2d2); border:1px solid #fff4; box-shadow:0 14px 38px #000b, inset 0 1px 0 #fff8; cursor:pointer}

  @media(min-width:560px){
    .title{font-size:48px}
    .big{font-size:54px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Happy Birthday, Sweetheart</div>
      <div class="sub">A tiny celebration made with love ðŸ’–</div>
    </header>

    <div id="bulbs" class="bulbs"></div>

    <main class="stage" aria-live="polite" aria-atomic="true">
      <div id="message" class="msg"></div>
      <div id="bigwish" class="big"></div>
      <div id="cakeWrap" class="cakeWrap">
        <div class="cake">
          <div class="icing"></div>
          <div class="candle"><div id="flame" class="flame"></div></div>
        </div>
      </div>
    </main>

    <div class="controls"><button id="action" class="btn" disabled>Loadingâ€¦</button></div>
    <div id="tip" class="tip"></div>

    <div id="fx" class="fx"></div>
    <canvas id="confetti"></canvas>
    <canvas id="fireworks"></canvas>

    <div id="curtain" class="curtain"><button id="start" class="start">Tap to Begin</button></div>
  </div>

<script>
(() => {
  /* ============ STATE ============ */
  let stepIndex = 0; // starts at first step, nothing runs until button click
  const stepLabels = [
    "Turn On Lights",
    "Release Balloons",
    "Show Loving Messages",
    "Bring the Cake",
    "Fireworks & Final Wish"
  ];

  const notes = [
    "Sweetheart, you light up my world in the softest, kindest ways. âœ¨",
    "Your smile is my favorite place to be. ðŸ˜Š",
    "Thank you for every laugh, every hug, every little moment. ðŸ’ž",
    "May this year be gentle, brave, and full of magic for you. ðŸŒŸ",
    "I love you â€” today, tomorrow, always. â¤ï¸"
  ];

  /* ============ ELEMENTS & CANVASES ============ */
  const action = document.getElementById('action');
  const tip = document.getElementById('tip');
  const curtain = document.getElementById('curtain');
  const start = document.getElementById('start');

  const bulbs = document.getElementById('bulbs');
  const message = document.getElementById('message');
  const bigwish = document.getElementById('bigwish');
  const cakeWrap = document.getElementById('cakeWrap');
  const flame = document.getElementById('flame');

  const fx = document.getElementById('fx');

  const confetti = document.getElementById('confetti');
  const cctx = confetti.getContext('2d');
  const fireworks = document.getElementById('fireworks');
  const fctx = fireworks.getContext('2d');

  function resize(){
    confetti.width = innerWidth; confetti.height = innerHeight;
    fireworks.width = innerWidth; fireworks.height = innerHeight;
  }
  addEventListener('resize', resize); resize();

  /* ============ MUSIC (WebAudio, offline) ============ */
  let audioStarted = false;
  let ac, mainGain, padGain, bellGain, playing = false;

  function setupAudio(){
    ac = new (window.AudioContext || window.webkitAudioContext)();
    mainGain = ac.createGain(); mainGain.gain.value = 0.5; mainGain.connect(ac.destination);

    padGain = ac.createGain(); padGain.gain.value = 0; padGain.connect(mainGain);
    bellGain = ac.createGain(); bellGain.gain.value = 0; bellGain.connect(mainGain);

    // Soft pad (detuned tri/sine)
    const pad1 = ac.createOscillator(); pad1.type = 'sine'; pad1.frequency.value = 220; pad1.detune.value = -3; pad1.connect(padGain); pad1.start();
    const pad2 = ac.createOscillator(); pad2.type = 'triangle'; pad2.frequency.value = 330; pad2.detune.value = +4; pad2.connect(padGain); pad2.start();

    // Gentle bell (AM)
    const bell = ac.createOscillator(); bell.type='sine'; bell.frequency.value = 660; bell.connect(bellGain); bell.start();

    // Slow pad fade-in/out loop
    function padLoop(){
      const now = ac.currentTime;
      const g = padGain.gain;
      g.cancelScheduledValues(now);
      g.setValueAtTime(g.value, now);
      g.linearRampToValueAtTime(0.35, now+3);
      g.linearRampToValueAtTime(0.28, now+7);
      g.linearRampToValueAtTime(0.35, now+11);
      g.linearRampToValueAtTime(0.00, now+15);
      setTimeout(padLoop, 15000);
    }
    // Gentle bell ping every few seconds
    function bellLoop(){
      const now = ac.currentTime;
      const g = bellGain.gain;
      g.cancelScheduledValues(now);
      g.setValueAtTime(0, now);
      g.linearRampToValueAtTime(0.45, now+0.01);
      g.exponentialRampToValueAtTime(0.001, now+1.5);
      setTimeout(bellLoop, 4200);
    }
    padLoop(); bellLoop();
    playing = true;
  }
  function startMusic(){
    if(audioStarted) return;
    audioStarted = true;
    setupAudio();
  }

  /* ============ HELPERS ============ */
  function showText(el, txt){
    message.classList.remove('show');
    bigwish.classList.remove('show');
    setTimeout(()=>{ el.textContent = txt; el.classList.add('show'); }, 120);
  }

  // Hearts ambient
  function heart(){
    const h=document.createElement('div');
    h.className='heart'; h.textContent='â¤ï¸';
    h.style.left = (6+Math.random()*88)+'vw';
    const dur = 4800 + Math.random()*3400;
    h.style.animationDuration = dur + 'ms';
    fx.appendChild(h);
    setTimeout(()=>h.remove(), dur+200);
  }

  // Balloons
  function balloon(){
    const b=document.createElement('div'); b.className='balloon';
    const w=60+Math.random()*30, h=80+Math.random()*40;
    b.style.width=w+'px'; b.style.height=h+'px';
    b.style.left=(10+Math.random()*80)+'vw';
    const hue = Math.floor(Math.random()*360);
    b.style.background = `radial-gradient(circle at 30% 30%, #fff9, hsl(${hue},80%,60%))`;
    b.style.animationDuration = (7000 + Math.random()*4000) + 'ms';
    const s=document.createElement('div'); s.className='string'; b.appendChild(s);
    fx.appendChild(b);
    setTimeout(()=>b.remove(), 12000);
  }

  // Confetti
  const confettiPieces = [];
  function addConfetti(n=160){
    for(let i=0;i<n;i++){
      confettiPieces.push({
        x: Math.random()*confetti.width,
        y: Math.random()*confetti.height - confetti.height,
        w: 6+Math.random()*8, h: 10+Math.random()*10,
        vx: Math.random()-0.5, vy: 2+Math.random()*3.5,
        rot: Math.random()*Math.PI*2, vr:(Math.random()-0.5)*0.12,
        c:`hsl(${Math.floor(Math.random()*360)},70%,60%)`
      });
    }
  }
  function drawConfetti(){
    cctx.clearRect(0,0,confetti.width,confetti.height);
    for(const p of confettiPieces){
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; if(p.y>confetti.height+24) p.y=-24;
      cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.rot);
      cctx.fillStyle=p.c; cctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); cctx.restore();
    }
    requestAnimationFrame(drawConfetti);
  }
  drawConfetti();

  // Fireworks
  const rockets = []; const particles = [];
  function launchFirework(x, y){
    const color = `hsl(${Math.random()*360}, 80%, 60%)`;
    // burst particles
    const count = 60 + Math.floor(Math.random()*30);
    for(let i=0;i<count;i++){
      const angle = (Math.PI*2) * (i/count);
      const speed = 2 + Math.random()*4;
      particles.push({
        x, y,
        vx: Math.cos(angle)*speed,
        vy: Math.sin(angle)*speed,
        life: 60 + Math.random()*20,
        color
      });
    }
  }
  function drawFireworks(){
    fctx.fillStyle = "rgba(0,0,0,0.15)";
    fctx.fillRect(0,0,fireworks.width,fireworks.height); // fade trail
    // Update rockets (optional: lift up points before burst)
    // Direct bursts at random locations:
    if (Math.random() < 0.04){
      const rx = 60 + Math.random()*(fireworks.width-120);
      const ry = 80 + Math.random()*(fireworks.height*0.5);
      launchFirework(rx, ry);
    }
    // Update particles
    for (let i=particles.length-1; i>=0; i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy;
      p.vy += 0.02; // gravity
      p.vx *= 0.99; p.vy *= 0.99;
      p.life -= 1;
      fctx.beginPath();
      fctx.fillStyle = p.color;
      fctx.arc(p.x, p.y, 2, 0, Math.PI*2);
      fctx.fill();
      if(p.life <= 0) particles.splice(i,1);
    }
    requestAnimationFrame(drawFireworks);
  }

  /* ============ STEP ACTIONS (only on click) ============ */
  function doStep(index){
    switch(index){
      case 0: { // Lights
        bulbs.classList.add('on');
        bulbs.innerHTML = '';
        for(let i=0;i<8;i++){
          const b = document.createElement('div'); b.className='bulb'; bulbs.appendChild(b);
          setTimeout(()=> b.classList.add('on'), i*220);
        }
        showText(message, "Lights on â€” let the night glow for you, Sweetheart âœ¨");
        addConfetti(80); // a little shimmer
        break;
      }
      case 1: { // Balloons
        for(let i=0;i<16;i++) setTimeout(balloon, i*280);
        showText(message, "Balloons rising with all my wishes for you ðŸŽˆ");
        break;
      }
      case 2: { // Loving messages (auto sequence within the step)
        let i=0;
        (function nextMsg(){
          if(i>=notes.length){ return; }
          showText(message, notes[i++]);
          setTimeout(nextMsg, 3600);
        })();
        break;
      }
      case 3: { // Cake
        cakeWrap.style.display='flex';
        showText(message, "Fresh from the heart's bakery â€” for you ðŸ°");
        setTimeout(()=> flame.classList.add('on'), 1000);
        break;
      }
      case 4: { // Fireworks + Final wish
        addConfetti(240);
        showText(bigwish, "Happy Birthday, Sweetheart! ðŸŽ†");
        // hearts flowing
        const hInt = setInterval(heart, 600);
        // start fireworks show
        drawFireworks();
        // stop hearts after a while (optional)
        setTimeout(()=> clearInterval(hInt), 30000);
        break;
      }
    }
  }

  /* ============ BUTTON FLOW ============ */
  function updateButton(){
    if(stepIndex < stepLabels.length){
      action.disabled = false;
      action.textContent = stepLabels[stepIndex];
      tip.textContent = (stepIndex===0) ? "Turn up your volume if you like music ðŸ”Š" : "";
    }else{
      action.style.display = 'none';
      tip.textContent='';
    }
  }

  // Start gate: first human tap enables audio + first label (no auto actions)
  start.addEventListener('click', async ()=>{
    curtain.style.display='none';
    startMusic(); // WebAudio init on gesture
    updateButton();
  });

  // Clicking the bottom button triggers the CURRENT step, then moves to the next
  action.addEventListener('click', ()=>{
    action.disabled = true;                 // prevent double tap
    doStep(stepIndex);                      // run current step
    stepIndex++;                            // advance for next label
    setTimeout(updateButton, 900);          // show next step label
  });

})();
</script>
</body>
</html>
